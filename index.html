<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leitor Imersivo: O Mercado das Emoções</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Ícones -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Fontes -->
    <link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        body { 
            font-family: 'Quicksand', sans-serif; 
            background-color: #1a1a1a; 
            color: #e5e5e5;
            height: 100vh;
            overflow: hidden; 
        }
        .font-handwritten { font-family: 'Patrick Hand', cursive; }
        
        /* Animações */
        .fade-in { animation: fadeIn 0.4s ease-out forwards; }
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.98); }
            to { opacity: 1; transform: scale(1); }
        }

        /* Scrollbar Personalizada */
        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: #2d2d2d; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #555; border-radius: 3px; }
        .custom-scroll::-webkit-scrollbar-thumb:hover { background: #777; }
    </style>
</head>
<body class="flex flex-col h-screen w-full">

    <!-- Barra de Ferramentas -->
    <header class="bg-neutral-900 border-b border-neutral-800 p-3 shrink-0 flex justify-between items-center z-20 shadow-md">
        <div class="flex items-center gap-3 text-indigo-400">
            <i data-lucide="book-open" class="w-6 h-6"></i>
            <h1 class="font-bold text-lg tracking-wide text-white hidden sm:block">Leitor Imersivo</h1>
        </div>

        <div class="flex items-center gap-4">
            <span id="statusMsg" class="text-xs font-bold text-neutral-500 uppercase tracking-widest bg-neutral-800 px-3 py-1 rounded-full">Modo Automático</span>

            <!-- Input de Arquivo -->
            <input type="file" id="fileInput" multiple accept="image/*" class="hidden" onchange="handleFileSelect(this)">
            <button onclick="document.getElementById('fileInput').click()" class="bg-indigo-600 hover:bg-indigo-500 text-white px-4 py-1.5 rounded-full text-sm font-bold flex items-center gap-2 transition-all shadow-lg hover:shadow-indigo-500/20 cursor-pointer">
                <i data-lucide="upload" class="w-4 h-4"></i>
                <span class="hidden sm:inline">Carregar Manualmente</span>
            </button>
        </div>
    </header>

    <!-- Área Principal -->
    <main class="flex-1 flex flex-col md:flex-row overflow-hidden relative">
        
        <!-- ÁREA DA IMAGEM -->
        <div class="flex-1 bg-black relative flex items-center justify-center overflow-hidden p-2 md:p-4">
            
            <!-- Imagem Principal -->
            <img id="storyImage" src="" 
                 class="max-w-full max-h-full w-auto h-auto object-contain shadow-2xl hidden fade-in" 
                 alt="Ilustração"
                 onerror="handleImageError()"
                 onload="handleImageLoad()">
            
            <!-- Placeholder (Erro ou Carregando) -->
            <div id="imagePlaceholder" class="text-center text-neutral-600 flex flex-col items-center">
                <i data-lucide="image-off" class="w-20 h-20 mb-4 opacity-20"></i>
                <p class="text-lg font-medium">Imagem não encontrada.</p>
                <p class="text-sm opacity-60 mt-1">Certifique-se que o arquivo está na pasta ou carregue manualmente.</p>
            </div>

            <!-- Botões Sobrepostos -->
            <button onclick="changePage(-1)" id="btnPrevOverlay" class="absolute left-4 top-1/2 -translate-y-1/2 bg-black/50 hover:bg-black/80 text-white p-3 rounded-full backdrop-blur-sm transition-all disabled:opacity-0 disabled:pointer-events-none z-10 hidden md:block cursor-pointer">
                <i data-lucide="chevron-left" class="w-8 h-8"></i>
            </button>

            <button onclick="changePage(1)" id="btnNextOverlay" class="absolute right-4 top-1/2 -translate-y-1/2 bg-black/50 hover:bg-black/80 text-white p-3 rounded-full backdrop-blur-sm transition-all disabled:opacity-0 disabled:pointer-events-none z-10 hidden md:block cursor-pointer">
                <i data-lucide="chevron-right" class="w-8 h-8"></i>
            </button>

            <!-- Label da Página -->
            <div class="absolute bottom-4 left-1/2 -translate-x-1/2 bg-black/70 backdrop-blur-md text-white px-4 py-1.5 rounded-full text-xs font-bold border border-white/10 shadow-xl z-10">
                <span id="pageLabel">Aguardando...</span>
            </div>
        </div>

        <!-- ÁREA DE TEXTO -->
        <div class="w-full md:w-[400px] shrink-0 bg-neutral-900 border-l border-neutral-800 flex flex-col shadow-2xl z-20">
            <div id="textContent" class="flex-1 p-8 overflow-y-auto custom-scroll flex flex-col justify-center">
                <p class="text-neutral-500 text-center italic">O texto da história aparecerá aqui.</p>
            </div>

            <!-- Controles Mobile -->
            <div class="md:hidden border-t border-neutral-800 p-4 flex justify-between bg-neutral-900">
                <button onclick="changePage(-1)" id="btnPrevMobile" class="p-2 bg-neutral-800 rounded-lg text-white disabled:opacity-30">
                    <i data-lucide="chevron-left"></i>
                </button>
                <button onclick="changePage(1)" id="btnNextMobile" class="p-2 bg-indigo-600 rounded-lg text-white disabled:opacity-30">
                    <i data-lucide="chevron-right"></i>
                </button>
            </div>
        </div>
    </main>

    <script>
        // --- DADOS DA HISTÓRIA COM NOMES DE ARQUIVO ---
        const storyData = [
            { 
                fileName: "00 - capa.png",
                type: 'cover', 
                title: "O Mercado das Emoções Enlatadas", 
                text: "Uma história sobre descobrir o que realmente sentimos." 
            },
            { 
                fileName: "01 - pag 1.png",
                text: "Bem-vindo ao Mercado das Emoções! Aqui, as prateleiras flutuam como nuvens e os potes de vidro brilham mais que vaga-lumes. Léo entrou devagar. Sua mochila estava vazia, mas sua cabeça estava cheia de preocupações. 'Uau!', sussurrou Léo. 'Quanta coisa a gente pode sentir!'" 
            },
            { 
                fileName: "02 - pag 2.png",
                text: "No balcão, a Vovó Sabe-Tudo ajeitava seus óculos gigantes. 'Olá, pequeno! O que você procura hoje? Um pouco de Alegria com sabor de limão? Ou talvez Paciência em pó?' 'Não, senhora', disse Léo. 'Eu preciso de um pote grande de Coragem. O escuro do meu quarto está muito... escuro.'" 
            },
            { 
                fileName: "03 - pag 3.png",
                text: "De repente... CRASH! BOING! PLOFT! O Monstro da Confusão, um bichinho feito de lã cinza e todo embaraçado, tropeçou nos próprios pés. Ele esbarrou na estante principal e derrubou dezenas de potes no chão. 'Ai, minha nossa!', gritou o Monstro. 'Misturei tudo!'" 
            },
            { 
                fileName: "04 - pag 4.png",
                text: "A bagunça estava feita. O pote vermelho agora tinha o rótulo de 'Calma'. O pote azul gelado estava com o nome de 'Raiva'. Léo pegou um pote que dizia 'Coragem', mas quando abriu, saiu uma fumaça rosa com cheiro de chiclete. 'Isso não é Coragem!', riu a Vovó. 'Isso é Vontade de Comer Doce!'" 
            },
            { 
                fileName: "05 - pag 5.png",
                text: "Léo ficou preocupado. 'Como vou achar a Coragem agora? Todos os rótulos estão errados!' A Vovó Sabe-Tudo sorriu e desceu do balcão. 'Léo, muitas vezes a gente acha que sente uma coisa, mas é outra. Não confie no rótulo. Você precisa abrir e sentir o cheiro.'" 
            },
            { 
                fileName: "06 - Pag 6.png", // Atenção à maiúscula no print
                text: "Léo pegou um pote cinza que parecia assustador. Ele abriu devagarzinho. Não saiu monstro nenhum. Saiu um ventinho frio e silencioso. 'Brrr!', tremeu Léo. 'Esse dá medo. Vou jogar fora!' 'Espere!', disse a Vovó. 'Esse é o Medo de Cair. Ele serve para te avisar para não chegar perto do abismo. Ele é útil, Léo.'" 
            },
            { 
                fileName: "07 - Pag 7.png", // Atenção à maiúscula no print
                text: "O Monstro da Confusão entregou um pote dourado para Léo, achando que era ouro. Léo cheirou. Tinha cheiro de... pimenta! Fazia o nariz coçar e dava vontade de correr. 'Achei!', gritou Léo. 'Isso é a Coragem!' Mas a Vovó negou com a cabeça. 'Não, querido. Isso é a Impaciência. Ela faz a gente correr sem olhar para onde vai.'" 
            },
            { 
                fileName: "08 - pag 8.png",
                text: "Léo fechou os olhos. Ele procurou um pote que não fosse nem muito quente, nem muito frio. Achou um pote laranja, meio amassado. Ao abrir, sentiu o coração bater forte, mas sentiu os pés firmes no chão. Tinha cheiro de terra molhada e sol da manhã. 'É este!', disse Léo. 'Sinto um pouquinho de medo junto, mas sinto que consigo ir em frente.' 'Exato!', celebrou a Vovó. 'A Coragem nunca anda sozinha. Ela anda de mãos dadas com o Medo.'" 
            },
            { 
                fileName: "09 - pag 9.png",
                text: "Feliz, Léo ajudou o Monstro a organizar a bagunça. Eles cheiraram pote por pote. 'Hum, cheiro de pão quentinho... É o Amor de Vó!', disse o Monstro, desenrolando sua lã e ficando colorido. Quando terminaram, o mercado estava brilhando novamente." 
            },
            { 
                fileName: "10 - pag 10.png",
                text: "Léo guardou seu pote de Coragem na mochila. 'Obrigado, Vovó! Agora sei que, se eu sentir medo no escuro, posso abrir meu pote.' 'E lembre-se, Léo', piscou ela. 'A maior fábrica de emoções não é este mercado. É aí dentro do seu peito.' Léo saiu da loja, pronto para apagar a luz e dormir." 
            },
            { 
                fileName: "11 - Fim.png",
                type: 'final', 
                text: "Léo entrou no seu quarto escuro. Ele colocou o pote de Coragem na cabeceira, mas nem precisou abrir. O brilho laranja agora vinha de dentro dele, misturado com um pouquinho de cinza do medo, e estava tudo bem. Ele fechou os olhos e dormiu, sabendo que todas as emoções do mundo moravam no seu próprio coração." 
            }
        ];

        let currentPage = 0;
        let images = {}; // Armazena URLs de upload manual

        lucide.createIcons();
        renderPage(); // Renderiza ao iniciar

        // Teclado
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowRight') changePage(1);
            if (e.key === 'ArrowLeft') changePage(-1);
        });

        function handleFileSelect(input) {
            const files = Array.from(input.files);
            
            // Ordenação Inteligente
            files.sort((a, b) => {
                return parseInt(a.name) - parseInt(b.name);
            });

            files.forEach((file, index) => {
                if (index < storyData.length) {
                    images[index] = URL.createObjectURL(file);
                }
            });

            if(files.length > 0) {
                currentPage = 0;
                document.getElementById('statusMsg').textContent = "Imagens Carregadas";
                renderPage();
            }
        }

        function changePage(direction) {
            const newPage = currentPage + direction;
            if (newPage >= 0 && newPage < storyData.length) {
                currentPage = newPage;
                renderPage();
            }
        }

        // Funções para lidar com o carregamento da imagem
        function handleImageLoad() {
            document.getElementById('storyImage').classList.remove('hidden');
            document.getElementById('imagePlaceholder').classList.add('hidden');
        }

        function handleImageError() {
            document.getElementById('storyImage').classList.add('hidden');
            document.getElementById('imagePlaceholder').classList.remove('hidden');
        }

        function renderPage() {
            const data = storyData[currentPage];
            
            const imgElement = document.getElementById('storyImage');
            const textContainer = document.getElementById('textContent');
            const pageLabel = document.getElementById('pageLabel');
            
            const btnPrevOverlay = document.getElementById('btnPrevOverlay');
            const btnNextOverlay = document.getElementById('btnNextOverlay');
            const btnPrevMobile = document.getElementById('btnPrevMobile');
            const btnNextMobile = document.getElementById('btnNextMobile');

            // 1. Tenta carregar imagem (Manual OU Automática)
            // Se houver upload manual (images[currentPage]), usa ele.
            // Se não, usa o fileName padrão.
            // O evento 'onerror' no HTML vai lidar se o arquivo não existir.
            const source = images[currentPage] || data.fileName;
            
            // Força o navegador a tentar carregar, mesmo se a source for a mesma (para re-testar se o arquivo apareceu)
            imgElement.src = ""; 
            imgElement.src = source;

            // 2. Labels e Botões
            pageLabel.textContent = currentPage === 0 ? "Capa" : (currentPage === storyData.length - 1 ? "Final" : `Página ${currentPage}`);

            const isFirst = currentPage === 0;
            const isLast = currentPage === storyData.length - 1;
            [btnPrevOverlay, btnPrevMobile].forEach(btn => btn.disabled = isFirst);
            [btnNextOverlay, btnNextMobile].forEach(btn => btn.disabled = isLast);

            // 3. Texto
            textContainer.classList.remove('fade-in');
            void textContainer.offsetWidth; 
            textContainer.classList.add('fade-in');

            if (data.type === 'cover') {
                textContainer.innerHTML = `
                    <div class="text-center">
                        <span class="text-indigo-400 font-bold tracking-widest text-xs uppercase mb-6 block border-b border-neutral-800 pb-4">Livro Ilustrado</span>
                        <h2 class="text-4xl md:text-5xl font-bold text-white font-handwritten leading-tight mb-8">${data.title}</h2>
                        <div class="w-24 h-1 bg-indigo-500 mx-auto rounded-full mb-8"></div>
                        <p class="text-xl text-neutral-400 font-medium italic">${data.text}</p>
                        <button onclick="changePage(1)" class="mt-12 text-indigo-400 hover:text-white transition-colors font-bold text-sm uppercase tracking-wide flex items-center justify-center gap-2 mx-auto cursor-pointer">
                            Começar a Ler <i data-lucide="arrow-right" class="w-4 h-4"></i>
                        </button>
                    </div>
                `;
            } else if (data.type === 'final') {
                textContainer.innerHTML = `
                    <div class="text-center">
                         <h3 class="text-3xl font-bold text-indigo-400 mb-6 font-handwritten">Fim</h3>
                         <div class="w-16 h-1 bg-indigo-900 mx-auto rounded-full mb-8"></div>
                         <p class="text-xl text-neutral-300 leading-relaxed font-handwritten">${data.text}</p>
                    </div>
                `;
            } else {
                textContainer.innerHTML = `
                    <div class="flex flex-col h-full justify-center">
                        <p class="text-2xl md:text-3xl text-neutral-200 leading-relaxed font-handwritten text-left">
                            "${data.text}"
                        </p>
                    </div>
                `;
            }
            lucide.createIcons();
        }
    </script>
</body>
</html>